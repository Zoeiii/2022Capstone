<p-breadcrumb [model]="items"></p-breadcrumb>
<p-confirmDialog #cd header="Confirmation" icon="pi pi-exclamation-triangle">
  <ng-template pTemplate="footer">
    <button
      type="button"
      pButton
      icon="pi pi-times"
      label="No"
      (click)="cd.reject()"
    ></button>
    <button
      type="button"
      pButton
      icon="pi pi-check"
      label="Yes"
      (click)="cd.accept()"
    ></button>
  </ng-template>
</p-confirmDialog>
<p-toast></p-toast>
<section>
  <p-table
    [value]="events"
    [paginator]="true"
    [rows]="10"
    [showCurrentPageReport]="true"
    [resizableColumns]="true"
    [rowsPerPageOptions]="[10, 25, 50]"
    styleClass="p-datatable-sm"
    responsiveLayout="scroll"
    editMode="row"
    dataKey="EventId"
  >
    <!-- dataKey="EventId", is the key here to edit by row, and it must be a unique field of your data -->
    <ng-template pTemplate="caption">
      <p>List of Events in {{ currentCity.CityName }}</p>
    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 3rem"></th>
        <th pSortableColumn="EventName">
          Event Name<p-sortIcon field="EventName"></p-sortIcon>
        </th>
        <th pSortableColumn="EventOrganizer">
          Event Organizer<p-sortIcon field="EventOrganizer"></p-sortIcon>
        </th>
        <th pSortableColumn="StartTime">
          Event StartTime<p-sortIcon field="StartTime"></p-sortIcon>
        </th>
        <th pSortableColumn="EndTime">
          Event EndTime<p-sortIcon field="EndTime"></p-sortIcon>
        </th>
        <th pSortableColumn="Location">
          Event Location<p-sortIcon field="Location"></p-sortIcon>
        </th>
        <th pSortableColumn="CityName">
          City<p-sortIcon field="CityName"></p-sortIcon>
        </th>
        <th pSortableColumn="MaxAttendeeSize">
          Max Attendee<p-sortIcon field="MaxAttendeeSize"></p-sortIcon>
        </th>
        <th>Edit/Delete</th>
      </tr>
    </ng-template>
    <ng-template
      pTemplate="body"
      let-events
      let-editing="editing"
      let-ri="rowIndex"
      let-expanded="expanded"
    >
      <!-- <tr (click)="route()" class="pointerCursor"> -->
      <tr [pEditableRow]="events">
        <td>
          <button
            type="button"
            pButton
            pRipple
            [pRowToggler]="events"
            class="p-button-text p-button-rounded p-button-plain"
            [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
          ></button>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="text" [(ngModel)]="events.EventName" />
            </ng-template>
            <ng-template pTemplate="output">
              {{ events.EventName }}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input
                pInputText
                type="text"
                [(ngModel)]="events.EventOrganizer"
              />
            </ng-template>
            <ng-template pTemplate="output">
              {{ events.EventOrganizer }}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <p-calendar
                [showTime]="true"
                hourFormat="24"
                [minDate]="minDate"
                [monthNavigator]="true"
                [yearNavigator]="true"
                yearRange="2022:2030"
                [appendTo]="'body'"
                [placeholder]="events.StartTime"
              ></p-calendar>
            </ng-template>
            <ng-template pTemplate="output">{{
              events.StartTime | date: "short"
            }}</ng-template></p-cellEditor
          >
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <p-calendar
                [showTime]="true"
                hourFormat="24"
                [minDate]="minDate"
                [monthNavigator]="true"
                [yearNavigator]="true"
                yearRange="2022:2030"
                [appendTo]="'body'"
                [placeholder]="events.EndTime"
              ></p-calendar>
            </ng-template>
            <ng-template pTemplate="output">{{
              events.EndTime | date: "short"
            }}</ng-template></p-cellEditor
          >
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="text" [(ngModel)]="events.Location" />
            </ng-template>
            <ng-template pTemplate="output"> {{ events.Location }}</ng-template>
          </p-cellEditor>
        </td>
        <td>
          {{ events.CityName }}
        </td>

        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <p-inputNumber
                mode="decimal"
                [showButtons]="true"
                [(ngModel)]="events.MaxAttendeeSize"
              >
              </p-inputNumber>
            </ng-template>
            <ng-template pTemplate="output">
              {{ events.MaxAttendeeSize }}</ng-template
            >
          </p-cellEditor>
        </td>
        <td style="text-align: center">
          <button
            *ngIf="!editing"
            pButton
            pRipple
            type="button"
            pInitEditableRow
            icon="pi pi-pencil"
            (click)="onRowEditInit(events)"
            class="p-button-rounded p-button-text"
          ></button>
          <button
            *ngIf="editing"
            pButton
            pRipple
            type="button"
            pSaveEditableRow
            icon="pi pi-check"
            (click)="onRowEditSave(events)"
            class="p-button-rounded p-button-text p-button-success p-mr-2"
          ></button>
          <button
            *ngIf="editing"
            pButton
            pRipple
            type="button"
            pCancelEditableRow
            icon="pi pi-times"
            (click)="onRowEditCancel(events, ri)"
            class="p-button-rounded p-button-text p-button-danger"
          ></button>
          <button
            *ngIf="!editing"
            pButton
            pRipple
            type="button"
            class="p-button-rounded p-button-danger p-button-text"
            icon="pi pi-trash"
            (click)="confirmDelete(events.EventId)"
          ></button>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="paginatorleft">
      <p-button
        type="button"
        icon="pi pi-refresh"
        (click)="refresh()"
        styleClass="p-button-text"
      ></p-button>
    </ng-template>
    <ng-template pTemplate="paginatorright">
      <p-button label="Create New Event" (click)="createNewEvent()"></p-button>
    </ng-template>

    <ng-template pTemplate="rowexpansion" let-events>
      <tr>
        <td colspan="2"></td>
        <td colspan="5">
          <div class="p-p-3">
            <p-table [value]="events.Members" dataKey="MemberId">
              <ng-template pTemplate="caption">
                <p>Add event description here</p>
              </ng-template>
              <ng-template pTemplate="header">
                <tr>
                  <th pSortableColumn="MemberName">
                    Memeber Name <p-sortIcon field="MemberName"></p-sortIcon>
                  </th>
                  <th pSortableColumn="MemberEmail">
                    Member Email <p-sortIcon field="MemberEmail"></p-sortIcon>
                  </th>
                  <th pSortableColumn="MemberPhone">
                    Member Phone <p-sortIcon field="MemberPhone"></p-sortIcon>
                  </th>
                  <th pSortableColumn="EditAccess">
                    Edit Access <p-sortIcon field="EditAccess"></p-sortIcon>
                  </th>
                  <th style="width: 4rem"></th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-attendee>
                <tr>
                  <td>{{ attendee.MemberName }}</td>
                  <td>{{ attendee.MemberEmail }}</td>
                  <td>{{ attendee.MemberPhone }}</td>
                  <td>{{ attendee.hasEditAccess }}</td>
                  <td>
                    <p-button type="button" icon="pi pi-search"></p-button>
                  </td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="6">There are no attendee for this event yet.</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</section>
